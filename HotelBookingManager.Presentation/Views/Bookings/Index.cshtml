@model IEnumerable<HotelBookingManager.BusinessObjects.DTO.BookingDto>

@{
    ViewData["Title"] = "Quản lý booking";
    var currentStatus = (ViewBag.Status as string) ?? "Pending";

    bool isAdminOrStaff = User.IsInRole("Admin") || User.IsInRole("Staff");
}

<h2>Quản lý booking</h2>

<a asp-action="Create" class="btn btn-success mb-3">Tạo booking</a>

<form asp-action="Index" method="get" class="mb-3">
    <label class="form-label me-2">Trạng thái</label>
    <select name="status"
            class="form-select d-inline-block w-auto"
            onchange="this.form.submit()">
        <option value="Pending" selected="@(currentStatus == "Pending")">Pending</option>
        <option value="Confirmed" selected="@(currentStatus == "Confirmed")">Confirmed</option>
        <option value="CheckedIn" selected="@(currentStatus == "CheckedIn")">Checked In</option>
        <option value="Completed" selected="@(currentStatus == "Completed")">Checked Out</option>
        <option value="Cancelled" selected="@(currentStatus == "Cancelled")">Cancelled</option>
        <option value="All" selected="@(currentStatus == "All")">Tất cả</option>
    </select>
</form>

<table class="table table-bordered table-striped">
    <thead class="table-light">
        <tr>
            <th>Booking #</th>

            @if (isAdminOrStaff)
            {
                <th>Khách (UserId)</th>
            }

            <th>Khách sạn (HotelId)</th>
            <th>Phòng (RoomId)</th>
            <th>Check-in</th>
            <th>Check-out</th>
            <th>Tổng tiền</th>
            <th>Trạng thái</th>
        </tr>
    </thead>

    <tbody>
        @foreach (var b in Model)
        {
            <tr>
                <td>@b.BookingId</td>

                @if (isAdminOrStaff)
                {
                    <td>@b.UserId</td>
                }

            <td>@b.HotelId</td>
            <td>@b.RoomId</td>
            <td>@b.CheckInDate.ToString("dd/MM/yyyy")</td>
            <td>@b.CheckOutDate.ToString("dd/MM/yyyy")</td>
            <td>@b.TotalPrice.ToString("N0")</td>

            <td>
                <span class="badge
                        @(b.Status == "Pending" ? "bg-warning text-dark" :
                                                b.Status == "Confirmed" ? "bg-primary" :
                                                b.Status == "CheckedIn" ? "bg-info" :
                                                b.Status == "Completed" ? "bg-success" :
                                                "bg-danger")">
                    @b.Status
                </span>
            </td>
        </tr>
                }
    </tbody>
</table>
